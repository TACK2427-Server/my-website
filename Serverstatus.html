<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minecraft サーバーステータス</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #1e1e1e;
      color: white;
      text-align: center;
      padding: 2rem;
    }
    .server {
      background-color: #2e2e2e;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .status-online { color: #00ff00; }
    .status-offline { color: #ff4444; }
    .icon {
      width: 64px;
      height: 64px;
      border-radius: 8px;
    }
    .motd {
      font-size: 0.9rem;
      color: #ccc;
      margin: 0.5rem 0;
    }
  </style>
</head>
<body>
  <h1>Minecraft サーバーステータス</h1>

  <div id="servers"></div>

  <script>
    const servers = [
      "tack2427.aternos.me",
      "tackruka.aternos.me"
    ];

    async function fetchServerStatus(address) {
      const res = await fetch(`https://api.mcstatus.io/v2/status/java/${address}?_=${Date.now()}`);
      if (!res.ok) throw new Error("取得失敗");
      return res.json();
    }

    function stripHtml(str) {
      const div = document.createElement("div");
      div.innerHTML = str;
      return div.textContent || div.innerText || "";
    }

    async function load() {
      const container = document.getElementById("servers");
      for (const address of servers) {
        const div = document.createElement("div");
        div.className = "server";
        div.innerHTML = `<h2>${address}</h2><p>取得中...</p>`;
        container.appendChild(div);

        try {
          const data = await fetchServerStatus(address);
          const online = data.online;
          const icon = data.icon ? `data:image/png;base64,${data.icon}` : "";
          const motd = stripHtml(data.motd.html || data.motd.clean || "");
          const max = data.players.max || "?";
          const current = data.players.online || "0";

          div.innerHTML = `
            <h2>${address}</h2>
            ${icon ? `<img src="${icon}" alt="icon" class="icon">` : ""}
            <p class="${online ? "status-online" : "status-offline"}">
              ${online ? "オンライン" : "オフライン"}
            </p>
            <div class="motd">${motd}</div>
            ${online ? `<p>プレイヤー数: ${current} / ${max}</p>` : ""}
          `;
        } catch (err) {
          div.innerHTML = `<h2>${address}</h2><p style="color:red;">取得失敗</p>`;
        }
      }
    }

    load();
  </script>
</body>
</html>

